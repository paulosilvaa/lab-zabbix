<VirtualHost *:443>
SSLEngine On
SSLCertificateFile /etc/httpd/ssl/{{ domain }}.crt
SSLCertificateKeyFile /etc/httpd/ssl/{{ domain }}.key
ServerName zabbix.{{ domain }}
DocumentRoot /usr/share/zabbix
ErrorLog /var/log/httpd/zabbix-error.log
CustomLog /var/log/httpd/zabbix.log combined

#
# Zabbix monitoring system php web frontend
#

Alias /zabbix /usr/share/zabbix

ProxyTimeout 300

<Directory "/usr/share/zabbix">
    Options FollowSymLinks
    AllowOverride None
    Require all granted

    <IfModule dir_module>
        DirectoryIndex index.php
    </IfModule>

    <FilesMatch \.(php|phar)$>
        SetHandler "proxy:unix:/run/php-fpm/zabbix.sock|fcgi://localhost"
    </FilesMatch>
</Directory>

<Directory "/usr/share/zabbix/conf">
    Require all denied
</Directory>

<Directory "/usr/share/zabbix/app">
    Require all denied
</Directory>

<Directory "/usr/share/zabbix/include">
    Require all denied
</Directory>

<Directory "/usr/share/zabbix/local">
    Require all denied
</Directory>

</VirtualHost>